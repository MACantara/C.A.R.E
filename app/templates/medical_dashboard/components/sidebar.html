<!-- TODO: Create a working Queue system that integrates with the appointment system -->

<!-- Simple FOUC prevention -->
<script>
    (function() {
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        document.documentElement.classList.add(isCollapsed ? 'sidebar-collapsed-init' : 'sidebar-expanded-init');
    })();
</script>

<style>
    /* Simple initial state handling - no animations */
    .sidebar-expanded-init .sidebar-full { display: flex; }
    .sidebar-expanded-init .sidebar-collapsed { display: none; }
    .sidebar-collapsed-init .sidebar-full { display: none; }
    .sidebar-collapsed-init .sidebar-collapsed { display: flex; }
</style>

<!-- Medical Dashboard Sidebar Navigation -->
<div class="sidebar-container">
    <div
        class="sidebar-full w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col flex-shrink-0 min-h-screen">
        <!-- Sidebar Header -->
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center">
                <div
                    class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-600 rounded-lg flex items-center justify-center mr-3">
                    <i class="bi bi-hospital text-white text-lg"></i>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Medical Hub</h2>
                    <p class="text-xs text-gray-500 dark:text-gray-400">{{ current_user.role.title() }} Dashboard</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="flex-1 overflow-y-auto py-4">
            <div class="px-4 mb-6">
                <nav class="space-y-1">
                    <a href="{{ url_for('medical_dashboard.dashboard') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-house mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Dashboard Overview
                    </a>
                </nav>
            </div>

            <!-- Medical Records Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-file-medical mr-1"></i>
                    Medical Records 
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('medical_records.index') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200">
                        <i class="bi bi-file-medical mr-3 text-gray-400 group-hover:text-purple-500"></i>
                        Medical Records Dashboard
                    </a>
                    <a href="{{ url_for('medical_records.patients') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-people mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Patient Directory
                    </a>
                    <a href="{{ url_for('medical_records.search_records') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-search mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Search Patients
                    </a>
                </nav>
            </div>

            <!-- Appointments & Schedule Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-calendar-week mr-1"></i>
                    Appointments
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('appointments.doctor_schedule') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 hover:text-green-600 dark:hover:text-green-400 transition-all duration-200">
                        <i class="bi bi-calendar-event mr-3 text-gray-400 group-hover:text-green-500"></i>
                        View Schedule
                    </a>
                </nav>
            </div>

            <!-- Reports & Analytics Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-graph-up mr-1"></i>
                    Reports & Analytics
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('reports.dashboard') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-pie-chart mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Analytics Dashboard
                    </a>
                    <a href="{{ url_for('reports.appointment_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-calendar-check mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Appointment Reports
                    </a>
                    <a href="{{ url_for('reports.prescription_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-prescription mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Prescription Reports
                    </a>
                    <a href="{{ url_for('reports.performance_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-speedometer2 mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Performance Metrics
                    </a>
                </nav>
            </div>

            <!-- Messages Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-chat-dots mr-1"></i>
                    Communication
                </h3>
                <nav class="space-y-1">
                    {% set icon_style = 'sidebar' %}
                    {% set icon_id = 'unread-messages-count' %}
                    {% include 'partials/messages-icon.html' %}
                </nav>
            </div>
        </div>

        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <!-- Time and status info -->
            <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 mb-3">
                <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                <span class="mr-2">Online</span>
                <span class="mx-2">•</span>
                <i class="bi bi-clock mr-2"></i>
                <span id="sidebar-timezone">{{ user_timezone }}</span>
                <span class="mx-2">•</span>
                <span id="sidebar-time">{{ current_time_local.strftime('%I:%M %p') }}</span>
            </div>
            
            <!-- User info and quick actions -->
            <div class="space-y-2">
                <!-- User profile link -->
                <a href="{{ url_for('profile.profile') }}"
                    class="flex items-center px-2 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold mr-3">
                        {{ current_user.first_name[0].upper() }}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium truncate">{{ current_user.first_name }} {{ current_user.last_name }}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ current_user.role.title() }}</p>
                    </div>
                </a>
                
                <!-- Quick action buttons -->
                <div class="flex items-center justify-between">
                    <!-- Home link -->
                    <a href="{{ url_for('main.home') }}"
                        class="p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200"
                        title="Home">
                        <i class="bi bi-house text-base"></i>
                    </a>
                    
                    <!-- Theme dropdown -->
                    {% set dropdown_id = 'sidebar-theme-menu' %}
                    {% set button_id = 'sidebar-theme-toggle' %}
                    {% set size = 'md' %}
                    {% set position = 'top-left' %}
                    {% set show_chevron = false %}
                    {% set button_classes = 'text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20' %}
                    {% include 'partials/theme-dropdown.html' %}

                    <!-- Logout -->
                    <a href="{{ url_for('auth.logout') }}"
                        class="p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200"
                        title="Logout">
                        <i class="bi bi-box-arrow-right text-base"></i>
                    </a>
                    
                    <!-- Collapse button -->
                    <button onclick="toggleSidebar()"
                        class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200"
                        title="Collapse sidebar">
                        <i class="bi bi-chevron-left text-base"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collapsed Sidebar -->
    <div id="collapsed-sidebar"
        class="sidebar-collapsed w-16 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col flex-shrink-0 min-h-screen">
        <!-- Collapsed Header -->
        <div class="px-3 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-center">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-600 rounded-lg flex items-center justify-center">
                <i class="bi bi-hospital text-white text-lg"></i>
            </div>
        </div>

        <!-- Collapsed Navigation -->
        <div class="flex-1 py-4">
            <nav class="space-y-2 px-2">
                <!-- Quick access icons -->
                <a href="{{ url_for('medical_records.patients') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200"
                    title="Patient Directory">
                    <i class="bi bi-people text-lg"></i>
                </a>
                <a href="{{ url_for('appointments.doctor_schedule') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-all duration-200"
                    title="Schedule">
                    <i class="bi bi-calendar-event text-lg"></i>
                </a>
                <a href="{{ url_for('medical_records.index') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-all duration-200"
                    title="Medical Records">
                    <i class="bi bi-file-medical text-lg"></i>
                </a>
                <a href="{{ url_for('reports.dashboard') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-lg transition-all duration-200"
                    title="Reports">
                    <i class="bi bi-graph-up text-lg"></i>
                </a>
                {% set icon_style = 'collapsed' %}
                {% set icon_id = 'collapsed-unread-count' %}
                {% include 'partials/messages-icon.html' %}
            </nav>
        </div>

        <!-- Collapsed Footer -->
        <div class="p-3 border-t border-gray-200 dark:border-gray-700">
            <div class="space-y-2 flex flex-col items-center">
                <!-- User avatar -->
                <a href="{{ url_for('profile.profile') }}"
                    class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold hover:scale-105 transition-transform duration-200"
                    title="{{ current_user.username }}">
                    {{ current_user.first_name[0].upper() }}
                </a>
                
                <!-- Quick actions -->
                <div class="flex flex-col space-y-2 items-center">
                    <a href="{{ url_for('main.home') }}"
                        class="flex justify-center p-1 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200"
                        title="Home">
                        <i class="bi bi-house text-base"></i>
                    </a>
                    <!-- Theme dropdown for collapsed sidebar -->
                    {% set dropdown_id = 'collapsed-theme-menu' %}
                    {% set button_id = 'collapsed-theme-toggle' %}
                    {% set size = 'md' %}
                    {% set position = 'top-right' %}
                    {% set show_chevron = false %}
                    {% set button_classes = 'text-gray-400 hover:text-purple-600 dark:hover:text-purple-400' %}
                    {% include 'partials/theme-dropdown.html' %}
                </div>
                
                <!-- Expand button -->
                <button onclick="toggleSidebar()"
                    class="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors cursor-pointer"
                    title="Expand sidebar">
                    <i class="bi bi-chevron-right text-base"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>