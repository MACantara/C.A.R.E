<!-- Simple FOUC prevention -->
<script>
    (function() {
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        document.documentElement.classList.add(isCollapsed ? 'sidebar-collapsed-init' : 'sidebar-expanded-init');
    })();
</script>

<style>
    /* Simple initial state handling - no animations */
    .sidebar-expanded-init .sidebar-full { display: flex; }
    .sidebar-expanded-init .sidebar-collapsed { display: none; }
    .sidebar-collapsed-init .sidebar-full { display: none; }
    .sidebar-collapsed-init .sidebar-collapsed { display: flex; }
</style>

<!-- Medical Dashboard Sidebar Navigation -->
<div class="sidebar-container">
    <div
        class="sidebar-full w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col flex-shrink-0 min-h-screen">
        <!-- Sidebar Header -->
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center">
                <div
                    class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-600 rounded-lg flex items-center justify-center mr-3">
                    <i class="bi bi-hospital text-white text-lg"></i>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Medical Hub</h2>
                    <p class="text-xs text-gray-500 dark:text-gray-400">{{ current_user.role.title() }} Dashboard</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="flex-1 overflow-y-auto py-4">
            <div class="px-4 mb-6">
                <nav class="space-y-1">
                    <a href="{{ url_for('medical_dashboard.dashboard') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-house mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Dashboard Overview
                    </a>
                </nav>
            </div>

            <!-- Medical Records Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-file-medical mr-1"></i>
                    Medical Records
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('medical_records.index') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200">
                        <i class="bi bi-file-medical mr-3 text-gray-400 group-hover:text-purple-500"></i>
                        Medical Records
                    </a>
                    <a href="{{ url_for('medical_records.patients') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-people mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Patient Directory
                    </a>
                    <a href="{{ url_for('medical_records.search_records') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200">
                        <i class="bi bi-search mr-3 text-gray-400 group-hover:text-blue-500"></i>
                        Search Patients
                    </a>
                    {% if current_user.role == 'doctor' %}
                    <a href="{{ url_for('medical_records.new_consultation') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-teal-700 dark:text-teal-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200 bg-teal-50/50 dark:bg-teal-900/10">
                        <i class="bi bi-plus-circle mr-3 text-teal-500"></i>
                        New Consultation
                        <span
                            class="ml-auto bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 text-xs px-2 py-1 rounded-full">Quick</span>
                    </a>
                    <a href="{{ url_for('medical_records.new_prescription') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200">
                        <i class="bi bi-prescription2 mr-3 text-gray-400 group-hover:text-purple-500"></i>
                        Write Prescription
                    </a>
                    {% endif %}
                </nav>
            </div>

            <!-- Appointments & Schedule Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-calendar-week mr-1"></i>
                    Appointments
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('appointments.doctor_schedule') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 hover:text-green-600 dark:hover:text-green-400 transition-all duration-200">
                        <i class="bi bi-calendar-event mr-3 text-gray-400 group-hover:text-green-500"></i>
                        View Schedule
                    </a>
                    <a href="{{ url_for('queue.dashboard') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-orange-50 dark:hover:bg-orange-900/20 hover:text-orange-600 dark:hover:text-orange-400 transition-all duration-200">
                        <i class="bi bi-people mr-3 text-gray-400 group-hover:text-orange-500"></i>
                        Queue Management
                        <span id="queue-count"
                            class="ml-auto bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 text-xs px-2 py-1 rounded-full hidden">{{
                            stats.queue_waiting }}</span>
                    </a>
                </nav>
            </div>

            <!-- Reports & Analytics Section -->
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2">
                    <i class="bi bi-graph-up mr-1"></i>
                    Reports & Analytics
                </h3>
                <nav class="space-y-1">
                    <a href="{{ url_for('reports.dashboard') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-pie-chart mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Analytics Dashboard
                    </a>
                    <a href="{{ url_for('reports.appointment_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-calendar-check mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Appointment Reports
                    </a>
                    <a href="{{ url_for('reports.prescription_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-prescription mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Prescription Reports
                    </a>
                    <a href="{{ url_for('reports.performance_report') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:text-teal-600 dark:hover:text-teal-400 transition-all duration-200">
                        <i class="bi bi-speedometer2 mr-3 text-gray-400 group-hover:text-teal-500"></i>
                        Performance Metrics
                    </a>
                </nav>
            </div>
        </div>

        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <!-- Time and status info -->
            <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 mb-3">
                <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                <span class="mr-2">Online</span>
                <span class="mx-2">•</span>
                <i class="bi bi-clock mr-2"></i>
                <span id="sidebar-timezone">{{ user_timezone }}</span>
                <span class="mx-2">•</span>
                <span id="sidebar-time">{{ current_time_local.strftime('%I:%M %p') }}</span>
            </div>
            
            <!-- User info and quick actions -->
            <div class="space-y-2">
                <!-- User profile link -->
                <a href="{{ url_for('profile.profile') }}"
                    class="flex items-center px-2 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold mr-3">
                        {{ current_user.username[0].upper() }}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium truncate">{{ current_user.username }}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ current_user.role.title() }}</p>
                    </div>
                </a>
                
                <!-- Quick action buttons -->
                <div class="flex items-center justify-between">
                    <!-- Home link -->
                    <a href="{{ url_for('main.home') }}"
                        class="p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200"
                        title="Home">
                        <i class="bi bi-house text-sm"></i>
                    </a>
                    
                    <!-- Theme toggle -->
                    <button id="sidebar-theme-toggle"
                        class="p-2 text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-all duration-200"
                        title="Toggle theme">
                        <i class="bi bi-sun-fill text-sm sidebar-theme-light"></i>
                        <i class="bi bi-moon-fill text-sm sidebar-theme-dark hidden"></i>
                        <i class="bi bi-circle-half text-sm sidebar-theme-system hidden"></i>
                    </button>
                    
                    <!-- Logout -->
                    <a href="{{ url_for('auth.logout') }}"
                        class="p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200"
                        title="Logout">
                        <i class="bi bi-box-arrow-right text-sm"></i>
                    </a>
                    
                    <!-- Collapse button -->
                    <button onclick="toggleSidebar()"
                        class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200"
                        title="Collapse sidebar">
                        <i class="bi bi-chevron-left text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collapsed Sidebar -->
    <div id="collapsed-sidebar"
        class="sidebar-collapsed w-16 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col flex-shrink-0 min-h-screen">
        <!-- Collapsed Header -->
        <div class="px-3 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-center">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-600 rounded-lg flex items-center justify-center">
                <i class="bi bi-hospital text-white text-lg"></i>
            </div>
        </div>

        <!-- Collapsed Navigation -->
        <div class="flex-1 py-4">
            <nav class="space-y-2 px-2">
                <!-- Quick access icons -->
                <a href="{{ url_for('medical_records.patients') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200"
                    title="Patient Directory">
                    <i class="bi bi-people text-lg"></i>
                </a>
                <a href="{{ url_for('appointments.doctor_schedule') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-all duration-200"
                    title="Schedule">
                    <i class="bi bi-calendar-event text-lg"></i>
                </a>
                <a href="{{ url_for('medical_records.index') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-all duration-200"
                    title="Medical Records">
                    <i class="bi bi-file-medical text-lg"></i>
                </a>
                <a href="{{ url_for('reports.dashboard') }}"
                    class="flex justify-center p-3 text-gray-400 hover:text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-lg transition-all duration-200"
                    title="Reports">
                    <i class="bi bi-graph-up text-lg"></i>
                </a>
            </nav>
        </div>

        <!-- Collapsed Footer -->
        <div class="p-3 border-t border-gray-200 dark:border-gray-700">
            <div class="space-y-2 flex flex-col items-center">
                <!-- User avatar -->
                <a href="{{ url_for('profile.profile') }}"
                    class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold hover:scale-105 transition-transform duration-200"
                    title="{{ current_user.username }}">
                    {{ current_user.username[0].upper() }}
                </a>
                
                <!-- Quick actions -->
                <div class="flex flex-col space-y-1">
                    <a href="{{ url_for('main.home') }}"
                        class="p-1 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200"
                        title="Home">
                        <i class="bi bi-house text-xs"></i>
                    </a>
                    <button id="collapsed-theme-toggle"
                        class="p-1 text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200"
                        title="Toggle theme">
                        <i class="bi bi-sun-fill text-xs collapsed-theme-light"></i>
                        <i class="bi bi-moon-fill text-xs collapsed-theme-dark hidden"></i>
                        <i class="bi bi-circle-half text-xs collapsed-theme-system hidden"></i>
                    </button>
                </div>
                
                <!-- Expand button -->
                <button onclick="toggleSidebar()"
                    class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors cursor-pointer"
                    title="Expand sidebar">
                    <i class="bi bi-chevron-right text-sm"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Simple sidebar functionality - no animations
    function toggleSidebar() {
        const fullSidebar = document.querySelector('.sidebar-full');
        const collapsedSidebar = document.getElementById('collapsed-sidebar');
        const isCurrentlyCollapsed = fullSidebar.style.display === 'none';

        if (isCurrentlyCollapsed) {
            // Show full sidebar instantly
            fullSidebar.style.display = 'flex';
            collapsedSidebar.style.display = 'none';
            localStorage.setItem('sidebarCollapsed', 'false');
        } else {
            // Show collapsed sidebar instantly
            fullSidebar.style.display = 'none';
            collapsedSidebar.style.display = 'flex';
            localStorage.setItem('sidebarCollapsed', 'true');
        }
    }

    // Update sidebar time
    function updateSidebarTime() {
        const sidebarTime = document.getElementById('sidebar-time');
        if (sidebarTime && window.timezoneManager) {
            const userTimezone = window.timezoneManager.getUserTimezone();
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                timeZone: userTimezone,
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            sidebarTime.textContent = timeString;
        }
    }

    // Theme toggle functionality
    function initSidebarThemeToggle() {
        const sidebarToggle = document.getElementById('sidebar-theme-toggle');
        const collapsedToggle = document.getElementById('collapsed-theme-toggle');
        
        function updateThemeIcons() {
            const theme = localStorage.getItem('theme') || 'system';
            const lightIcons = document.querySelectorAll('.sidebar-theme-light, .collapsed-theme-light');
            const darkIcons = document.querySelectorAll('.sidebar-theme-dark, .collapsed-theme-dark');
            const systemIcons = document.querySelectorAll('.sidebar-theme-system, .collapsed-theme-system');
            
            // Hide all icons first
            lightIcons.forEach(icon => icon.classList.add('hidden'));
            darkIcons.forEach(icon => icon.classList.add('hidden'));
            systemIcons.forEach(icon => icon.classList.add('hidden'));
            
            // Show appropriate icon
            if (theme === 'light') {
                lightIcons.forEach(icon => icon.classList.remove('hidden'));
            } else if (theme === 'dark') {
                darkIcons.forEach(icon => icon.classList.remove('hidden'));
            } else {
                systemIcons.forEach(icon => icon.classList.remove('hidden'));
            }
        }
        
        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'system';
            let newTheme;
            
            if (currentTheme === 'light') {
                newTheme = 'dark';
            } else if (currentTheme === 'dark') {
                newTheme = 'system';
            } else {
                newTheme = 'light';
            }
            
            localStorage.setItem('theme', newTheme);
            
            // Apply theme immediately
            if (newTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (newTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                // System theme
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
            
            updateThemeIcons();
        }
        
        // Add event listeners
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleTheme);
        }
        if (collapsedToggle) {
            collapsedToggle.addEventListener('click', toggleTheme);
        }
        
        // Initialize theme icons
        updateThemeIcons();
    }

    // Simple initialization - no fade effects
    document.addEventListener('DOMContentLoaded', function () {
        const fullSidebar = document.querySelector('.sidebar-full');
        const collapsedSidebar = document.getElementById('collapsed-sidebar');
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        
        // Set initial state instantly
        if (isCollapsed) {
            fullSidebar.style.display = 'none';
            collapsedSidebar.style.display = 'flex';
        } else {
            fullSidebar.style.display = 'flex';
            collapsedSidebar.style.display = 'none';
        }
        
        // No fade-in animation - sidebar shows immediately

        // Update time every minute
        updateSidebarTime();
        setInterval(updateSidebarTime, 60000);

        // Update queue count if available
        const queueCount = document.getElementById('queue-count');
        const queueWaiting = {{ stats.queue_waiting if stats and stats.queue_waiting else 0 }};
        if (queueCount && queueWaiting > 0) {
            queueCount.classList.remove('hidden');
        }

        // Initialize theme toggle
        initSidebarThemeToggle();
    });
</script>